From e23f60100d3e5e6abb18d3c24ba76d7177953aee Mon Sep 17 00:00:00 2001
From: ksrt12 <kazakov12stepan2012@live.ru>
Date: Thu, 25 May 2017 22:31:29 +0300
Subject: [PATCH] test

Change-Id: Ie356d73e917f7d2e787467868e45bba08abf25e7
---
 media/libstagefright/MediaCodec.cpp | 13 +++++++++++--
 1 file changed, 11 insertions(+), 2 deletions(-)

diff --git a/media/libstagefright/MediaCodec.cpp b/media/libstagefright/MediaCodec.cpp
index 5e0ee5544..10ae05709 100644
--- a/media/libstagefright/MediaCodec.cpp
+++ b/media/libstagefright/MediaCodec.cpp
@@ -53,6 +53,9 @@
 #include <utils/Singleton.h>
 #include <stagefright/AVExtensions.h>
 
+#include <cutils/properties.h>
+#include <string.h>
+
 namespace android {
 
 static int64_t getId(sp<IResourceManagerClient> client) {
@@ -174,8 +177,14 @@ bool MediaCodec::ResourceManagerServiceProxy::reclaimResource(
 sp<MediaCodec> MediaCodec::CreateByType(
         const sp<ALooper> &looper, const char *mime, bool encoder, status_t *err, pid_t pid) {
     sp<MediaCodec> codec = new MediaCodec(looper, pid);
-
-    const status_t ret = codec->init(mime, true /* nameIsType */, encoder);
+    status_t ret = -1;
+    //ALOGD("Fell978: mime = %s",mime);
+    if(!strcmp(mime,"video/avc") && encoder && property_get_bool("persist.sys.google_avc_enc",0)) {
+	 ret = codec->init("OMX.google.h264.encoder",false,encoder);
+	 ALOGI("persist.sys.google_avc_enc is set.");
+    }
+    else
+	 ret = codec->init(mime, true /* nameIsType */, encoder);
     if (err != NULL) {
         *err = ret;
     }
-- 
2.13.0

